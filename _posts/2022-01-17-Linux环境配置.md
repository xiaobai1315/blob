---
layout: post
title: "linux 环境配置"
date:   2022-01-19
tags: [linux]
comments: true
author: xiaobai
---

linux 环境配置

<!-- more -->

## linux 环境配置

### Linux安装Jenkins

* 安装JDK Jenkins需要依赖JDK，所以先安装JDK1.8

  `yum install java-1.8.0-openjdk* -y`

  安装目录为:/usr/lib/jvm

* 获取jenkins安装包 

  `https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat/` 下载Jenkins镜像

  将本地文件传输到Linux /export目录下

  `scp /Users/test/Desktop/jenkins-2.213-1.1.noarch.rpm root@xx.xx.xx.xx:/export`

* 安装jenkins

  `rpm -ivh jenkins-2.190.3-1.1.noarch.rpm`

* 修改Jenkins配置
  ` vi /etc/syscofig/jenkins`

```
JENKINS_USER="root"
JENKINS_PORT="8888"
```

* 启动Jenkins
  ` systemctl start jenkins`
* 打开浏览器访问 http://192.168.66.101:8888，跳过插件安装

* 卸载Jenkins

```
rpm -e jenkins    rpm卸载 
rpm -ql jenkins  检查是否卸载成功
find / -iname jenkins | xargs -n 1000 rm -rf  彻底删除残留文件
```



### 修改Jenkins插件下载地址

* Jenkins->Manage Jenkins->Manage Plugins，点击Available 下载官方的插件列表

* ```
  cd /var/lib/jenkins/updates
  sed -i 's/http:\/\/updates.jenkins-ci.org\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g' default.json && sed -i 's/http:\/\/www.google.com/https:\/\/www.baidu.com/g' default.json
  ```

* Manage Plugins点击Advanced，把Update Site改为国内插件下载地址

  `https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json`

*  `http://xx.xx.xx.xx:8888/restart `，重启Jenkins。

* 汉化插件： `Chinese`



### 权限管理

* 安装 `Role-based Authorization Strategy` 插件

* Dashboard-系统管理-全局安全配置-授权策略，勾选 `Role-Based Strategy`
* Dashboard-系统管理-Manage and Assign Roles-Manage Roles，添加角色
* Dashboard-系统管理-Manage Users-新建用户
* Dashboard-系统管理-Manage and Assign Roles，给用户分配角色



### Jenkins凭证管理

* 安装`Credentials Binding`插件

* 系统管理-Manage Credentials

  ```
  Username with password:用户名和密码
  SSH Username with private key: 使用SSH用户和密钥
  Secret file:需要保密的文本文件，使用时Jenkins会将文件复制到一个临时目录中，再将文件路径 设置到一个变量中，等构建结束后，所复制的Secret file就会被删除。
  Secret text:需要保存的一个加密的文本串，如钉钉机器人或Github的api token Certificate:通过上传证书文件的方式
  ```

* 安装`git`插件

* centos上安装git  

  ```
  yum install git -y 安装
  git --version 安装后查看版本
  ```

  

### jenkins 添加Git仓库

* Jenkins-系统管理-凭证配置，添加凭证

  Provider:Jenkins凭据提供者

  Type: SSH Username with private key

  Username ： github账号

  Private Key：ssh私钥

  Mac系统秘钥存放地址： cd ~/.ssh

* Jenkins新建项目，源码管理，选择git，输入Git项目地址(ssh地址)，选择已添加的ssh凭证，指定Git分支，构建项目

* 构建项目，构建成功后在`/var/lib/jenkins/workspace `目录下会看到下载的源码

  

### linux 安装maven

* 下载安装包 `https://maven.apache.org/download.cgi`

* 上传到Linux服务器

  `scp /Users/test/Desktop/maven.tar.gz root@xx.xx.xx.xx:/`

* tar -xzf apache-maven-3.6.2-bin.tar.gz 解压 

* mkdir -p /opt/maven 创建目录

* mv apache-maven-3.6.2/* /opt/maven 移动文件

  

### 配置环境变量

* vi /etc/profile

```
export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk
export MAVEN_HOME=/opt/maven
export PATH=$PATH:$JAVA_HOME/bin:$MAVEN_HOME/bin
```

* source /etc/profile 配置生效

* mvn -v 查找Maven版本



### 全局工具配置关联JDK和Maven

* Jenkins->Global Tool Configuration->JDK->新增JDK

  ```
  别名：JDK1.8
  JAVA_HOME: /usr/lib/jvm/java-1.8.0-openjdk
  ```

* 新增maven

  ```
  别名：maven3.8.3
  MAVEN_HOME: /opt/maven
  ```



### 添加Jenkins全局变量

* 系统管理-系统配置-全局属性-环境变量，添加以下键值对

  ```
  JAVA_HOME : /usr/lib/jvm/java-1.8.0-openjdk
  M2_HOME: /opt/maven
  PATH+EXTRA: $M2_HOME/bin
  ```

  

### 修改Maven的settings.xml

* mkdir /root/repo 创建本地仓库目录
*  vi /opt/maven/conf/settings.xml

```
修改本地仓库地址
<localRepository>/root/repo</localRepository>

// 添加镜像仓库
<mirror>
  <id>alimaven</id>
  <name>aliyun maven</name>
  <url>http://maven.aliyun.com/nexus/content/groups/public/</url>
  <mirrorOf>central</mirrorOf>
</mirror>
```



### 测试maven环境

创建Jenkins测试工程，构建后操作，增加构建步骤，执行shell  `mvn clean package`

`/var/lib/jenkins/workspace/test1/target` 路径下有打包成功war文件



### 安装Tomcat

* 下载Tomcat`https://tomcat.apache.org/download-80.cgi`

* 上传到服务器`scp apache-tomcat-8.5.73.tar.gz root@xx.xx.x.x:/`

```
tar -xzf apache-tomcat-8.5.47.tar.gz 解压
mkdir -p /opt/tomcat 创建目录  
mv /root/apache-tomcat-8.5.47/* /opt/tomcat 移动文件
/opt/tomcat/bin/startup.sh 启动tomcat, 地址为:http://x.x.x.x/8080
```



### 配置Tomcat用户角色权限

* `vi /opt/tomcat/conf/tomcat-users.xml`

  ```
  <tomcat-users>
      <role rolename="tomcat"/>
      <role rolename="role1"/>
      <role rolename="manager-script"/>
      <role rolename="manager-gui"/>
      <role rolename="manager-status"/>
      <role rolename="admin-gui"/>
      <role rolename="admin-script"/>
      <user username="tomcat" password="tomcat" roles="manager-gui,manager-
  script,tomcat,admin-gui,admin-script"/>
  </tomcat-users>
  ```

* `vi /opt/tomcat/webapps/manager/META-INF/context.xml`

```
<!--
 <Valve className="org.apache.catalina.valves.RemoteAddrValve"
-->
```

* 重启Tomcat

  ```
  /opt/tomcat/bin/shutdown.sh 停止
  /opt/tomcat/bin/startup.sh 启动
  ```

  

